{% extends './base.html' %}

{% block title %}Alumnos{% endblock %}

{% block content %}

  <div class="contenido-principal">
    
    <h4>Alumnos</h4>
    <p>En esta sección se podrán ver alumnos.</p>
    <div class="controladores">
      <input type="search" id="buscador" placeholder="Buscar alumno..." class="form-control " title="Escribe el nombre del alumno a buscar">
      <div class="controladores 1 gap-3">
        <a href="{% url 'agregar_alumno' %}" class="btn-añadir">
          <i class="fa-solid fa-plus"></i> Dar de alta alumno
        </a>
      </div>
    </div>

  </div>

  <table class="table table-striped tabla1">
    <thead>
      <tr>
        <th>#</th>
        <th>Alumno</th>
        <th>Telefono</th>
        <th>Correo</th>
        <th>Restricción</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for alumno in alumnos %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>
          <small>Clave Unica: <strong>{{ alumno.clave_alumno }}</strong></small>
          <br>
          {{ alumno.nombres }} {{ alumno.apellido_paterno }} {{ alumno.apellido_materno }}
        </td>
        <td>{{ alumno.telefono }}</td>
        <td>{{ alumno.correo }}</td>
        <td>
          <form method="post" action="{% url 'toggle_restriccion_alumno' alumno.id %}">
            {% csrf_token %}
            {% if alumno.restriccion_libre %}
            <button type="submit" class="btn btn-success btn-sm">Sin restricción</button>
            {% else %}
            <button type="submit" class="btn btn-outline-danger btn-sm">Restringido</button>
            {% endif %}
          </form>
        </td>
        <td>
          {% if alumno.estado_inscripcion == "Inscrito" %}
          <span class="estado inscrito">Inscrito</span>
          {% else %}
          <span class="estado no-inscrito">No inscrito</span>
          {% endif %}
        </td>
        <td>
          <a href="#" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#modalAlumno{{ alumno.id }}">
            Ver detalles
          </a>

          <!-- <a href="{% url 'historial_alumno' alumno.id %}" class="btn btn-sm btn-success">Historial</a> -->
          <a href="{% url 'editar_alumno' alumno.id %}" class="btn btn-sm btn-warning"><i class="fa fa-edit"></i> </a>
          <a href="{% url 'eliminar_alumno' alumno.id %}" class="btn btn-sm btn-danger"><i class="fa fa-trash"></i> </a>
        </td>
      </tr>
      <!-- Modal para el alumno -->
      <div class="modal fade" id="modalAlumno{{ alumno.id }}" tabindex="-1" aria-labelledby="modalAlumnoLabel{{ alumno.id }}" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content p-3">
            <div class="modal-header">
              <h5 class="modal-title" id="modalAlumnoLabel{{ alumno.id }}">Detalles del alumno</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
              <p><strong>Clave única:</strong> {{ alumno.clave_alumno }}</p>
              <p><strong>Alumno:</strong> {{ alumno.nombres }} {{ alumno.apellido_paterno }} {{ alumno.apellido_materno }}</p>
              <p><strong>Clave escolar:</strong> {{ alumno.clave }}</p>
              <hr>
              <p><strong>CURP:</strong> {{ alumno.curp }}</p>
              <p><strong>Correo:</strong> {{ alumno.correo }}</p>
              <p><strong>Teléfono:</strong> {{ alumno.telefono }}</p>
              <p><strong>Sexo:</strong> {{ alumno.sexo }}</p>
              <hr>
              <p>
                <strong>Historial:</strong>
                <a href="{% url 'historial_alumno' alumno.id %}" class="btn btn-sm btn-success">Ver Historial de {{ alumno.nombres }}</a>
              </p>
            </div>
          </div>
        </div>
      </div>

      {% endfor %}
    </tbody>
  </table>
  
  <!-- <div class="py-3 contenedor-cursos">
  
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Listado de alumnos</h3>
          <div class="card-tools">
          </div>
        </div>
        <div class="card-body table-responsive p-0" style="height: 600px;">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>#</th>
                <th>Alumno</th>
                <th>Clave escolar</th>
                <th>CURP</th>
                <th>Correo</th>
                <th>Telefono</th>
                <th>Restricción</th>
                <th>Estado</th>
                <th style="width: 300px;">Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% for alumno in alumnos %}
              <tr>
                <td>{{ forloop.counter }}</td>
                <td>
                  {{ alumno.nombres }}   {{ alumno.apellido_paterno }} {{ alumno.apellido_materno }}
                  <br>
                  <small>Clave Unica: <strong>{{ alumno.clave_alumno }}</strong></small>
                </td>
                <td>{{ alumno.clave }}</td>
                <td>{{ alumno.curp }}</td>
                <td>{{ alumno.correo }}</td>
                <td>{{ alumno.telefono }}</td>
                <td>
                  <form method="post" action="{% url 'toggle_restriccion_alumno' alumno.id %}">
                    {% csrf_token %}
                    {% if alumno.restriccion_libre %}
                      <button type="submit" class="btn btn-success btn-sm">Sin restricción</button>
                    {% else %}
                      <button type="submit" class="btn btn-outline-danger btn-sm">Restringido</button>
                    {% endif %}
                  </form>
                </td>
                <th>
                  {% if alumno.estado_inscripcion == "Inscrito" %}
                    <span class="estado inscrito">Inscrito</span>
                  {% else %}
                    <span class="estado no-inscrito">No inscrito</span>
                  {% endif %}

                </th>
                <td>
                  <a href="{% url 'historial_alumno' alumno.id %}" class="btn btn-sm btn-success">Historial</a>
                  <a href="{% url 'editar_alumno' alumno.id %}" class="btn btn-sm btn-warning"><i class="fa fa-edit"></i> </a>
                  <a href="{% url 'eliminar_alumno' alumno.id %}" class="btn btn-sm btn-danger"><i class="fa fa-trash"></i> </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="8" class="text-center">No hay alumnos registrados.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div> -->
  </div>
{% endblock %}
